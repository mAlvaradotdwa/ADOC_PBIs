expression FACT_TUNGYA =
		let
		    Consulta1 = Value.NativeQuery(SapHana.Database("vhadoahpdb01.hec.empresasadoc.com:30215", [Implementation="2.0"]), "WITH NAST_RANKED AS (#(lf)    SELECT #(lf)        OBJKY, #(lf)        DATVR,#(lf)        ROW_NUMBER() OVER (PARTITION BY OBJKY ORDER BY DATVR ASC) AS rn#(lf)    FROM SAP_ECC.NAST#(lf)    WHERE VSTAT = '1'#(lf)    AND ERDAT >= '20230101'#(lf))#(lf)SELECT#(lf)    ZTUNGYA_MK_UPD.EBELN as Doc_compra,#(lf)    --EKPO_KONNR.LBELN AS Nro_Expediente,#(lf)    EKKO_EBELN.BUKRS as Entidad_Compra,#(lf)    EKKO_EBELN.EKORG as Entidad_Solicitante,#(lf)    EKKO_EBELN.ZZ_CENTRO_D as Entidad_CD,#(lf)    EKKO_EBELN.BSART as Tipo_Doc,#(lf)    ZTUNGYA_MK_UPD.TXZ01 Text_Breve,#(lf)    CASE WHEN LEFT(ZTUNGYA_MK_UPD.TXZ01, 7) = 'Prepack' THEN CAST(SUBSTRING_REGEXPR('(\d+)' IN ZTUNGYA_MK_UPD.TXZ01 GROUP 1) AS INTEGER) ELSE 1 END * ZTUNGYA_MK_UPD.QTY_BOOKED AS CANTIDAD_PARES,#(lf)    SUBSTRING(ZTUNGYA_MK_UPD.TXZ01, 1, INSTR(ZTUNGYA_MK_UPD.TXZ01, ',') - 1) AS Estilo_Color,#(lf)    ZTUNGYA_MK_UPD.MATNR,#(lf)    MARA.SATNR,#(lf)    MARA.GROES AS ESTILO,#(lf)    MARA.FREE_CHAR AS COLOR,#(lf)    MARA.BRAND_ID AS MARCA,#(lf)    MARA.ZZ_ART_PROV AS GENERO,#(lf)    MARA.ZZ_DEPART AS DEPARTAMENTO,#(lf)    MARA.SAISO AS PE,#(lf)    MARA.MEINS AS UNIDAD,#(lf)    EKPO_EBELN.BRTWR AS PrecioBruto_PO,#(lf)    EKKO_EBELN.AEDAT AS Fecha_Creacion,#(lf)    EKKO_EBELN.BEDAT AS Fecha_Documento,#(lf)    NAST.DATVR AS Fecha_Liberacion,#(lf)    NAST.VSTAT AS Estatus,#(lf)    EKPO_EBELN.ZFACTORY AS Fecha_Xfactory_Original,#(lf)    EKPO_EBELN.ZFACTORYO AS Fecha_Xfactory_Actualizada,#(lf)    EKKO_EBELN.ZZF_DESPACHO AS Fecha_Despacho,#(lf)    ZTUNGYA_MK_UPD.NBOOKING as Nro_booking,#(lf)    ZTUNGYA_MK_UPD.BOOKING_DATE AS Fecha_Booking,#(lf)    ZTUNGYA_MK_UPD.QTY_BOOKED as Cantidad_Booking,#(lf)    ZTUNGYA_MK_UPD.CARGO_READY_DATE,#(lf)    ZTUNGYA_MK_UPD.DATE_ARRIVAL as Fecha_arrival_CFS,#(lf)    ZTUNGYA_MK_UPD.HOUSE_BILL,#(lf)    ZTUNGYA_MK_UPD.INVOICE_NUMBER AS Nro_factura,#(lf)    ZTUNGYA_MK_UPD.ETD,#(lf)    ZTUNGYA_MK_UPD.ETA,#(lf)    --EKPO_KONNR.FECHA_LIQ #(lf)    '' as Fecha_Liq,#(lf)    ZMM_EXPED_IMP.FECHA_CIERRE AS Fecha_Liquidacion,#(lf)    ZTUNGYA_MK_UPD.PORT,#(lf)    EKKO_EBELN.INCO2 AS PUERTO_NOMBRE,#(lf)    ZTUNGYA_MK_UPD.LAND1,#(lf)    ZTUNGYA_MK_UPD.ARRIVAL_VESSEL,#(lf)    ZTUNGYA_MK_UPD.CONTAINER AS Contenedor,#(lf)    EKKO_EBELN.ZZ_TIPO_FLETE AS Modalidad_Despacho,#(lf)    ZTUNGYA_MK_UPD.UP_DATE,#(lf)    ZTUNGYA_MK_UPD.LOEKZ,#(lf)    ZTUNGYA_MK_UPD.ZIMP,#(lf)    ZTUNGYA_MK_UPD.LBELN,#(lf)    EKKO_EBELN.LIFNR AS Codigo_Proveedor#(lf)FROM SAP_ECC.ZTUNGYA_MK_UPD#(lf)LEFT JOIN SAP_ECC.MARA#(lf)ON ZTUNGYA_MK_UPD.MATNR = MARA.MATNR#(lf)LEFT JOIN SAP_ECC.EKKO AS EKKO_KONNR#(lf)ON ZTUNGYA_MK_UPD.EBELN = EKKO_KONNR.KONNR#(lf)LEFT JOIN SAP_ECC.EKKO AS EKKO_EBELN#(lf)ON ZTUNGYA_MK_UPD.EBELN = EKKO_EBELN.EBELN#(lf)--LEFT JOIN SAP_ECC.EKPO AS EKPO_KONNR#(lf)--ON ZTUNGYA_MK_UPD.EBELN = EKPO_KONNR.KONNR AND EKPO_KONNR.MATNR = ZTUNGYA_MK_UPD.MATNR#(lf)LEFT JOIN SAP_ECC.EKPO AS EKPO_EBELN#(lf)ON ZTUNGYA_MK_UPD.EBELN = EKPO_EBELN.EBELN AND EKPO_EBELN.MATNR = ZTUNGYA_MK_UPD.MATNR#(lf)LEFT JOIN SAP_ECC.ZMM_EXPED_IMP#(lf)ON ZTUNGYA_MK_UPD.LBELN = ZMM_EXPED_IMP.LBELN#(lf)LEFT JOIN SAP_ECC.NAST#(lf)ON ZTUNGYA_MK_UPD.EBELN = NAST.OBJKY#(lf) AND NAST.DATVR = (#(lf)    SELECT DATVR FROM NAST_RANKED WHERE OBJKY = NAST.OBJKY AND rn = 1#(lf))#(lf)WHERE ZTUNGYA_MK_UPD.LOEKZ <> 'L'#(lf)AND EKPO_EBELN.LOEKZ <> 'L'#(lf)AND EKPO_EBELN.RETPO <> 'X'#(lf)--AND EKPO_KONNR.LOEKZ <> 'L'#(lf)--AND EKPO_KONNR.RETPO <> 'X'#(lf)--AND ZTUNGYA_MK_UPD.EBELN = '4400050494'", null, [EnableFolding=true]),
		    #"Valor reemplazado" = Table.ReplaceValue(Consulta1,"00000000","",Replacer.ReplaceText,{"FECHA_CREACION", "FECHA_DOCUMENTO", "FECHA_XFACTORY_ORIGINAL", "FECHA_XFACTORY_ACTUALIZADA", "FECHA_DESPACHO", "FECHA_BOOKING", "CARGO_READY_DATE", "FECHA_ARRIVAL_CFS", "ETD", "ETA", "FECHA_LIQ", "FECHA_LIQUIDACION", "UP_DATE"}),
		    #"Tipo cambiado" = Table.TransformColumnTypes(#"Valor reemplazado",{{"ETA", type date}, {"FECHA_BOOKING", type date}, {"CARGO_READY_DATE", type date}, {"FECHA_CREACION", type date}, {"FECHA_XFACTORY_ACTUALIZADA", type date}, {"FECHA_XFACTORY_ORIGINAL", type date}, {"FECHA_DOCUMENTO", type date}, {"FECHA_ARRIVAL_CFS", type date}, {"ETD", type date}, {"UP_DATE", type date}, {"FECHA_DESPACHO", type date}, {"FECHA_LIQUIDACION", type date}}),
		    #"Valor reemplazado1" = Table.ReplaceValue(#"Tipo cambiado","216","206",Replacer.ReplaceText,{"PORT"}),
		    #"Consultas combinadas" = Table.NestedJoin(#"Valor reemplazado1", {"PORT"}, PUERTO_ORIGEN, {"Code"}, "PUERTO_ORIGEN", JoinKind.LeftOuter),
		    #"Se expandió PUERTO_ORIGEN" = Table.ExpandTableColumn(#"Consultas combinadas", "PUERTO_ORIGEN", {"Name Country", "Tipo Linea"}, {"PUERTO_ORIGEN.Name Country", "PUERTO_ORIGEN.Tipo Linea"}),
		    #"Consultas combinadas1" = Table.NestedJoin(#"Se expandió PUERTO_ORIGEN", {"DOC_COMPRA"}, NAST, {"OBJKY"}, "NAST", JoinKind.LeftOuter),
		    #"Se expandió NAST" = Table.ExpandTableColumn(#"Consultas combinadas1", "NAST", {"FECHA_CREACION", "FECHA_LIBERACION"}, {"NAST.FECHA_CREACION", "NAST.FECHA_LIBERACION"}),
		    #"Columnas quitadas" = Table.RemoveColumns(#"Se expandió NAST",{"NAST.FECHA_CREACION"}),
		    #"Se cambió formato a fecha" = Table.TransformColumnTypes(#"Columnas quitadas",{{"FECHA_LIBERACION", type date}}),
		    // 2/12/2003 por 2/12/2023
		    #"Valor reemplazado2 CRD" = Table.ReplaceValue(#"Se cambió formato a fecha",#date(2003, 11, 5),#date(2023, 11, 5),Replacer.ReplaceValue,{"CARGO_READY_DATE"}),
		    // 5/11/2003 por 5/11/2023
		    #"Valor reemplazado3 CRD" = Table.ReplaceValue(#"Valor reemplazado2 CRD",#date(2003, 12, 2),#date(2023, 12, 2),Replacer.ReplaceValue,{"CARGO_READY_DATE"}),
		    #"Tipo cambiado1" = Table.TransformColumnTypes(#"Valor reemplazado3 CRD",{{"FECHA_LIQ", type date}})
		in
		    #"Tipo cambiado1"
	lineageTag: 51fe2c78-7eda-485f-ac7a-a0ad46a7f72c

	annotation PBI_NavigationStepName = Navegación

	annotation PBI_ResultType = Exception

